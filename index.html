<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Get User Location - Tableau Extension</title>
 <script type="text/javascript" 
  src="./tableau.extensions.1.latest.min.js">
</script>
</head>
<body>
  <h2>User Location</h2>
  <p id="location">Initializing...</p>

  <script>
    const output = document.getElementById('location');
    const log = (...args) => {
      console.log('[DEBUG]', ...args);
    };

    function showPosition(position) {
      const lat = position.coords.latitude.toFixed(6);
      const lng = position.coords.longitude.toFixed(6);
      output.textContent = `Latitude: ${lat}, Longitude: ${lng}`;
      log('Got position:', lat, lng);
    }

    function showError(error) {
      output.textContent = `Error: ${error.message}`;
      log('Geolocation error:', error.message);
    }

    function getGeolocation() {
      if ('geolocation' in navigator) {
        navigator.geolocation.getCurrentPosition(showPosition, showError);
      } else {
        output.textContent = "Geolocation not supported.";
      }
    }

    // Run only if we're in Tableau
    if (window.tableau) {
      tableau.extensions.initializeAsync().then(() => {
        log('Running inside Tableau');
        getGeolocation();
      }).catch(err => {
        output.textContent = `Extension failed to initialize: ${err.message}`;
        log('Initialization error:', err);
      });
    } else {
      log('⚠️ Not running inside Tableau. Skipping initializeAsync.');
      output.textContent = "This extension must be run in Tableau.";
    }
  </script>
</body>
</html>
